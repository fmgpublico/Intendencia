# Obtener un token de acceso.

```
curl -X POST "http://localhost:9090/realms/intendencia/protocol/openid-connect/token" --header "Content-Type: application/x-www-form-urlencoded" --data-urlencode "grant_type=password" --data-urlencode "client_id=intendencia" --data-urlencode "client_secret=7ZnfuQRWyUTgmlo3kfbTioBVyRLuuCnh" --data-urlencode "username=intendencia1" --data-urlencode "password=Cgb.12345"
```
Se obtiene:
{
	"access_token": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJpQmJCNWdxbWI2RGNSY0VCZUNDMkNSeUFwbkhQczZVVFo0Q1k3emlmTnV3In0.eyJleHAiOjE3NTU4NTIwMDQsImlhdCI6MTc1NTg1MTcwNCwianRpIjoib25ydHJvOjVjMDgzNTBkLTA3Y2MtNGNkNi1iZDJkLTk5NzU5MjIwODNkNiIsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTA5MC9yZWFsbXMvaW50ZW5kZW5jaWEiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiNmNhNmJlNjItZWFkMi00YmU2LTlmNzItMzhlMGM1OWEzOTc2IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiaW50ZW5kZW5jaWEiLCJzaWQiOiIzZDMwZWUwNS0xNDZjLTRkOTUtOWU0OS1kNDc2OWIwYjk4MmIiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iLCJkZWZhdWx0LXJvbGVzLWludGVuZGVuY2lhIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19LCJpbnRlbmRlbmNpYSI6eyJyb2xlcyI6WyJDTElFTlRFU19FTElNSU5BUiJdfX0sInNjb3BlIjoiZW1haWwgcHJvZmlsZSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJpbnRlbmRlbmNpYTEiLCJlbWFpbCI6ImZtYXJ0aW5AZXNsYS5jb20ifQ.igdwdIRLXTR_OgZ7ejU8Dq-AS84qtB8PEvbgQtoAL1y8ifRsUh2uY1mcFVFtgl7Yk2_aCRrj5UjSNeICrl6LnJZk-JDxXrG-4t2IBWg-fDU5_ERduOsoE5m6VJ5brvvAMuHfjGh2SChfJI1uKYLFmgZZsftm7Tm1dpmyE7fTpsVeCzluM5ObgMzWx2ZonbmzErYanUjgPlLhiw5hfXSX1lsMQ9URBXAhDvLllUxwRPrXtcg5HopY_T8jbw5S5E54av3d5GLf0M4v8PvZXRdXVJhTB0USDAtyrjWRZErL0WY8Rlg1RmesHbEOYe9Gr2z_KXBcnuBVjcjLCbqSBuBQFQ",
	"expires_in": 300,
	"refresh_expires_in": 1800,
	"refresh_token": "eyJhbGciOiJIUzUxMiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJmYjdlNmZhOC0wM2Y0LTQwMWYtODBiOS04YmVkODcyYmUyZGIifQ.eyJleHAiOjE3NTU4NTM1MDQsImlhdCI6MTc1NTg1MTcwNCwianRpIjoiNDY4NzEyNjctNTUyNC00ZjgwLTk5ZTMtMWIwZTY5ZjAzZTQyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDkwL3JlYWxtcy9pbnRlbmRlbmNpYSIsImF1ZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTA5MC9yZWFsbXMvaW50ZW5kZW5jaWEiLCJzdWIiOiI2Y2E2YmU2Mi1lYWQyLTRiZTYtOWY3Mi0zOGUwYzU5YTM5NzYiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoiaW50ZW5kZW5jaWEiLCJzaWQiOiIzZDMwZWUwNS0xNDZjLTRkOTUtOWU0OS1kNDc2OWIwYjk4MmIiLCJzY29wZSI6ImJhc2ljIGVtYWlsIHNlcnZpY2VfYWNjb3VudCBhY3Igd2ViLW9yaWdpbnMgcHJvZmlsZSByb2xlcyJ9.1dW8ZSql0wgv6izmLMEVcI0Z7U1K4PLXzPU5ovwMaUtXui4fPh9HdCaeKgiAlsWvLFqs2VNgAevyaGj7ISK4nw",
	"token_type": "Bearer",
	"not-before-policy": 0,
	"session_state": "3d30ee05-146c-4d95-9e49-d4769b0b982b",
	"scope": "email profile"
}

# Refrescar un token de acceso

Se utiliza el parámetro de la petición "grant_type=refresh_token".
En el parámetro de la petición "refresh_token" se pasa el token de refresco.

```
curl -X POST "http://localhost:9090/realms/intendencia/protocol/openid-connect/token" --header "Content-Type: application/x-www-form-urlencoded" --data-urlencode "grant_type=refresh_token" --data-urlencode "client_id=intendencia" --data-urlencode "client_secret=7ZnfuQRWyUTgmlo3kfbTioBVyRLuuCnh" --data-urlencode "refresh_token=eyJhbGciOiJIUzUxMiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJmYjdlNmZhOC0wM2Y0LTQwMWYtODBiOS04YmVkODcyYmUyZGIifQ.eyJleHAiOjE3NTQ2MzgzMDYsImlhdCI6MTc1NDYzNjUwNiwianRpIjoiNDMyMjgxNjQtODBiMC00MGY0LWE2MzctZWRjMDUzMmM5NDhjIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDkwL3JlYWxtcy9pbnRlbmRlbmNpYSIsImF1ZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTA5MC9yZWFsbXMvaW50ZW5kZW5jaWEiLCJzdWIiOiI2Y2E2YmU2Mi1lYWQyLTRiZTYtOWY3Mi0zOGUwYzU5YTM5NzYiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoiaW50ZW5kZW5jaWEiLCJzaWQiOiJmOWQ1NTZkZS1mM2U3LTQ0MDQtYjI3MS02Yjg5MjY3NTg4M2YiLCJzY29wZSI6ImJhc2ljIGVtYWlsIHNlcnZpY2VfYWNjb3VudCBhY3Igd2ViLW9yaWdpbnMgcHJvZmlsZSByb2xlcyJ9.EQxlUxaXZPAtj9BOYYbjaf_xsNsjlxKWAzQdrNqALCqj2ZNmGoe45IS8CFu5bzIicLdftGLLJnmyFeeD6QTUSg"
```
Devuelve un nuevo token de acceso.

# Obtener el estado de un token de acceso o de refresco

En el parámetro de la petición "token" se puede poner un token de acceso o uno de refresco.

```
curl -X POST "http://localhost:9090/realms/intendencia/protocol/openid-connect/token/introspect" --header "Content-Type: application/x-www-form-urlencoded" --data-urlencode "client_id=intendencia" --data-urlencode "client_secret=7ZnfuQRWyUTgmlo3kfbTioBVyRLuuCnh" --data-urlencode "token=eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJpQmJCNWdxbWI2RGNSY0VCZUNDMkNSeUFwbkhQczZVVFo0Q1k3emlmTnV3In0.eyJleHAiOjE3NTYyOTMwODEsImlhdCI6MTc1NjI5MzAyMSwianRpIjoib25ydHJvOmZlNDgzNTg0LTliZDQtNGE0Zi05OGFiLWVkZDExOTQ2YzMyNyIsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTA5MC9yZWFsbXMvaW50ZW5kZW5jaWEiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiNmNhNmJlNjItZWFkMi00YmU2LTlmNzItMzhlMGM1OWEzOTc2IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiaW50ZW5kZW5jaWEiLCJzaWQiOiI5NDhjNmU0ZC1iZWU0LTQ4YmEtYjU2NC1jNzE4YTA1Mjc5ZDgiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbImh0dHA6Ly9sb2NhbGhvc3Q6NTE3MyJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiIsImRlZmF1bHQtcm9sZXMtaW50ZW5kZW5jaWEiXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX0sImludGVuZGVuY2lhIjp7InJvbGVzIjpbIkNMSUVOVEVTX0VMSU1JTkFSIl19fSwic2NvcGUiOiJlbWFpbCBwcm9maWxlIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsInByZWZlcnJlZF91c2VybmFtZSI6ImludGVuZGVuY2lhMSIsImVtYWlsIjoiZm1hcnRpbkBlc2xhLmNvbSJ9.hwP1XnSvvL29QnBCjXpGuW-fkTBXKM5z5W_--0NHqfeO9e4nSzEcRshcL2WgrVKMcPFkJwDZqtLnQ-34sQki_O8qvz059f26RwUjeW2pBPNxtYwvFXy_H2WETHdb-DGYLtWGdivJybtUILT5sCkhaV3WvSCPUJ0jz-zy3xaWod4IgSSy5-Dn7sgc2tpUOYEwDuWvcRmy7n34UwUA0_FXKKIse6Tu0ZcAIsdW9GAEdHSZ5zm_MtdC8KTca54r2-X-n5VPv3dM4v24mt2qtsq66Fc7lfnNvrgOPuxdI5swrruuxs-ELVts2FBSVGl3iBDlTcZP21WXac64G7BtOUdVOA" 
```

Si el token no está activo devuelve:

```
{"active":false}
```

Si está activo devuelve información del token:

```
{
	"exp": 1754638306,
	"iat": 1754636506,
	"jti": "43228164-80b0-40f4-a637-edc0532c948c",
	"iss": "http://localhost:9090/realms/intendencia",
	"aud": [
		"http://localhost:9090/realms/intendencia",
		"account"
	],
	"sub": "6ca6be62-ead2-4be6-9f72-38e0c59a3976",
	"typ": "Refresh",
	"azp": "intendencia",
	"sid": "f9d556de-f3e7-4404-b271-6b892675883f",
	"acr": "1",
	"allowed-origins": [
		"http://localhost:8082"
	],
	"realm_access": {
		"roles": [
			"offline_access",
			"uma_authorization",
			"default-roles-intendencia"
		]
	},
	"resource_access": {
		"account": {
			"roles": [
				"manage-account",
				"manage-account-links",
				"view-profile"
			]
		}
	},
	"scope": "basic email service_account acr web-origins profile roles",
	"email_verified": true,
	"preferred_username": "intendencia1",
	"email": "fmartin@esla.com",
	"client_id": "intendencia",
	"username": "intendencia1",
	"token_type": "Refresh",
	"active": true
}
```

# Obtener las claves públicas habilitadas por el realm

Se usan por ejemplo para validar tokens cifrados.

```
curl -X POST "http://localhost:9090/realms/intendencia/protocol/openid-connect/certs
```

# Revocar un token de acceso o de refresco

```
POST /revoke HTTP/1.1
     Host: server.example.com
     Content-Type: application/x-www-form-urlencoded
     Authorization: Basic czZCaGRSa3F0MzpnWDFmQmF0M2JW

     token=45ghiukldjahdnhzdauz&token_type_hint=refresh_token
```

# Obtener información del usuario autenticado

Para poder obtener la información, cuando se obtiene el token de acceso hay que especificar el scope openid:

```
curl -X POST "http://localhost:9090/realms/intendencia/protocol/openid-connect/token" --header "Content-Type: application/x-www-form-urlencoded" --data-urlencode "grant_type=password" --data-urlencode "client_id=intendencia" --data-urlencode "client_secret=7ZnfuQRWyUTgmlo3kfbTioBVyRLuuCnh" --data-urlencode "username=intendencia1" --data-urlencode "password=Cgb.12345" --data-urlencode "scope=openid"
```

Y con el token de acceso que se obtiene se puede obtener la información del usuario autenticado:

```
curl -X GET -i -o - "http://localhost:9090/realms/intendencia/protocol/openid-connect/userinfo" --header "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJpQmJCNWdxbWI2RGNSY0VCZUNDMkNSeUFwbkhQczZVVFo0Q1k3emlmTnV3In0.eyJleHAiOjE3NTU1MDQyNjMsImlhdCI6MTc1NTUwMzk2MywianRpIjoib25ydHJvOmNkYTYwY2I3LWU3YTgtNDY1NS1iZGExLTNhNmU4OGEwYWI0YiIsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTA5MC9yZWFsbXMvaW50ZW5kZW5jaWEiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiNmNhNmJlNjItZWFkMi00YmU2LTlmNzItMzhlMGM1OWEzOTc2IiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiaW50ZW5kZW5jaWEiLCJzaWQiOiI0NTZjY2U0OC00YTNkLTRjNGItOGI2MS1jMWQ5MzAyYTNlNWMiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iLCJkZWZhdWx0LXJvbGVzLWludGVuZGVuY2lhIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJvcGVuaWQgZW1haWwgcHJvZmlsZSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJpbnRlbmRlbmNpYTEiLCJlbWFpbCI6ImZtYXJ0aW5AZXNsYS5jb20ifQ.kEFvcF6W6lUj7IGqiiNp5DOZVoDuzhI6X19EDokEcQWyMuBZLOpbbGmYTpXBDq2QyRcDdRDCoof6N978PXp9Zkcd80OLYKaxtn5LgJ1GRwrPEAzdwY8xqG0g5iFYXVaU-C-MK1J36Mk1eRaVI2VghmwD_EltdkCjq1CM4QwtdlSMuxlXkZGRgvFytgPU8dAbR3EbhgnSCNic0Bl4FhqkqCZDRIz7nMVyXsW9-gva_Ivu-wb9rdmtcCVYB0dySUJC0MQqtoNgZhqU9pQ8raAY-BPNgFZM-bX_51Hek4k_NVI1GKByKOqj8O2hiN-Y6LL_N331qiIM8Wy6mjoqHbkkWg"
```